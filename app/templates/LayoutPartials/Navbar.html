<nav class="navbar navbar-expand-lg navbar-light top-navbar py-2 px-4">
    <div class="container-fluid">
        <!-- Page Title -->
        <span class="navbar-brand mb-0 h1 d-none d-md-block" id="system-title">User Management System</span>
        
        <ul class="navbar-nav ms-auto">
            <!-- User Profile -->
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="navbarDropdownMenuUser" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <img src="../../static/images/profile.jpg" alt="User" class="user-avatar me-2">
                    <span class="text-dark" id="user-role-display">User</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuUser">
                    <li><a class="dropdown-item" href="{{ url_for('auth.logout') }}"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
                </ul>
            </li>
        </ul>
    </div>
</nav>

<!-- Navbar Script for Dynamic Role and Title -->
<script>
    // Function to update navbar based on user role
    function updateNavbarBasedOnRole() {
        // Get role from localStorage
        const userRole = localStorage.getItem('userRole') || 'Admin';
        
        // Set user display name based on role
        let roleDisplayName = 'User';
        let systemTitle = 'Management System';
        
        if (userRole === 'Admin') {
            roleDisplayName = 'Admin User';
            systemTitle = 'User Management System';
        } else if (userRole === 'Cleaner') {
            roleDisplayName = 'Cleaner User';
            systemTitle = 'Cleaner Management System';
        } else if (userRole === 'HomeOwner') {
            roleDisplayName = 'Home Owner User';
            systemTitle = 'Home Owner Management System';
        } else if (userRole === 'PlatformManagement') {
            roleDisplayName = 'Platform Management';
            systemTitle = 'Platform Management System';
        }
        
        // Find the elements to update
        const userRoleElement = document.getElementById('user-role-display');
        const systemTitleElement = document.getElementById('system-title');
        
        // Update elements if they exist
        if (userRoleElement) userRoleElement.textContent = roleDisplayName;
        if (systemTitleElement) systemTitleElement.textContent = systemTitle;
    }
    
    // Use both jQuery's ready and window.onload for maximum reliability
    $(document).ready(function() {
        // Try to update immediately
        updateNavbarBasedOnRole();
        
        // Also try again after a short delay to ensure DOM is fully loaded
        setTimeout(updateNavbarBasedOnRole, 100);
    });
    
    // Fallback for when dynamically loaded
    window.addEventListener('load', updateNavbarBasedOnRole);
    
    // Set up a MutationObserver as a final fallback to detect when elements are added
    // This ensures the navbar updates even if it's loaded after this script runs
    const observer = new MutationObserver(function(mutations) {
        const userRoleElement = document.getElementById('user-role-display');
        const systemTitleElement = document.getElementById('system-title');
        
        if (userRoleElement && systemTitleElement) {
            updateNavbarBasedOnRole();
            observer.disconnect(); // Stop observing once elements are found and updated
        }
    });
    
    // Start observing when DOM is ready
    $(document).ready(function() {
        observer.observe(document.body, { childList: true, subtree: true });
    });
</script> 